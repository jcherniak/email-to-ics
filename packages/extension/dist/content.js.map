{
  "version": 3,
  "sources": ["../src/content.ts"],
  "sourcesContent": ["/**\n * Content Script for Email-to-ICS Extension\n * Iframe-based architecture matching original\n */\n\nlet emailToIcsFrame: HTMLIFrameElement | null = null;\nlet dragHandle: HTMLDivElement | null = null;\nlet isDragging = false;\nlet dragStartX = 0;\nlet dragStartY = 0;\nlet frameStartX = 0;\nlet frameStartY = 0;\n\n// Listen for messages from background script\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  if (message.action === 'toggle-iframe') {\n    if (emailToIcsFrame) {\n      removeIframe();\n    } else {\n      createIframe(message.selectedText);\n    }\n    sendResponse({ success: true });\n  } else if (message.action === 'close-iframe') {\n    removeIframe();\n    sendResponse({ success: true });\n  } else if (message.action === 'get-page-info') {\n    sendResponse({\n      url: window.location.href,\n      title: document.title,\n      html: document.documentElement.outerHTML,\n      text: document.body.innerText\n    });\n  }\n});\n\n/**\n * Create iframe loading popup.html\n */\nfunction createIframe(selectedText?: string) {\n  if (emailToIcsFrame) {\n    return;\n  }\n\n  // Create container div for both drag handle and iframe\n  const container = document.createElement('div');\n  container.id = 'email-to-ics-container';\n  container.style.cssText = `\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    width: 450px;\n    height: 600px;\n    z-index: 2147483647;\n  `;\n\n  // Create drag handle\n  const handle = document.createElement('div');\n  handle.id = 'email-to-ics-draghandle';\n  handle.style.cssText = `\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 30px;\n    background: linear-gradient(to bottom, #0d6efd, #0b5ed7);\n    border-radius: 8px 8px 0 0;\n    cursor: move;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    user-select: none;\n    z-index: 2147483648;\n  `;\n\n  // Add drag handle icon/text\n  handle.innerHTML = `\n    <span style=\"color: white; font-family: system-ui, -apple-system, sans-serif; font-size: 14px; font-weight: 500;\">\n      \u22EE\u22EE\u22EE Email to ICS \u22EE\u22EE\u22EE\n    </span>\n  `;\n\n  dragHandle = handle;\n  container.appendChild(handle);\n\n  // Create iframe with adjusted positioning\n  const iframe = document.createElement('iframe');\n  iframe.id = 'email-to-ics-iframe';\n  iframe.src = chrome.runtime.getURL('popup.html');\n  iframe.style.cssText = `\n    position: absolute;\n    top: 30px;\n    left: 0;\n    width: 100%;\n    height: calc(100% - 30px);\n    background: white;\n    border: 3px solid #0d6efd;\n    border-top: none;\n    border-radius: 0 0 8px 8px;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n  `;\n\n  container.appendChild(iframe);\n  document.body.appendChild(container);\n  emailToIcsFrame = iframe;\n\n  // Add drag event listeners\n  setupDragHandlers(handle, container);\n\n  // Add resize functionality to container\n  makeResizable(container);\n\n  // Send current page info to iframe when it loads\n  iframe.onload = () => {\n    iframe.contentWindow?.postMessage({\n      type: 'INIT_FROM_CONTENT',\n      data: {\n        url: window.location.href,\n        title: document.title,\n        selectedText: selectedText\n      }\n    }, '*');\n  };\n}\n\n/**\n * Setup drag handlers for the drag handle\n */\nfunction setupDragHandlers(handle: HTMLDivElement, container: HTMLDivElement) {\n  handle.addEventListener('mousedown', (e) => {\n    isDragging = true;\n    dragStartX = e.clientX;\n    dragStartY = e.clientY;\n\n    const rect = container.getBoundingClientRect();\n    frameStartX = rect.left;\n    frameStartY = rect.top;\n\n    // Change cursor and add overlay to prevent iframe from capturing events\n    document.body.style.cursor = 'move';\n    const overlay = document.createElement('div');\n    overlay.id = 'email-to-ics-drag-overlay';\n    overlay.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      z-index: 2147483646;\n      cursor: move;\n    `;\n    document.body.appendChild(overlay);\n\n    e.preventDefault();\n  });\n\n  document.addEventListener('mousemove', (e) => {\n    if (!isDragging) return;\n\n    const deltaX = e.clientX - dragStartX;\n    const deltaY = e.clientY - dragStartY;\n\n    let newLeft = frameStartX + deltaX;\n    let newTop = frameStartY + deltaY;\n\n    // Get container dimensions\n    const container = document.getElementById('email-to-ics-container');\n    if (!container) return;\n\n    const rect = container.getBoundingClientRect();\n\n    // Keep within viewport bounds\n    newLeft = Math.max(0, Math.min(newLeft, window.innerWidth - rect.width));\n    newTop = Math.max(0, Math.min(newTop, window.innerHeight - rect.height));\n\n    container.style.left = newLeft + 'px';\n    container.style.top = newTop + 'px';\n    container.style.right = 'auto';\n  });\n\n  document.addEventListener('mouseup', () => {\n    if (isDragging) {\n      isDragging = false;\n      document.body.style.cursor = '';\n\n      // Remove overlay\n      const overlay = document.getElementById('email-to-ics-drag-overlay');\n      if (overlay) {\n        overlay.remove();\n      }\n    }\n  });\n}\n\n/**\n * Make container resizable\n */\nfunction makeResizable(container: HTMLDivElement) {\n  // Add resize handle\n  const resizeHandle = document.createElement('div');\n  resizeHandle.style.cssText = `\n    position: absolute;\n    bottom: 0;\n    right: 0;\n    width: 20px;\n    height: 20px;\n    cursor: nwse-resize;\n    z-index: 2147483649;\n  `;\n\n  let isResizing = false;\n  let resizeStartX = 0;\n  let resizeStartY = 0;\n  let startWidth = 0;\n  let startHeight = 0;\n\n  resizeHandle.addEventListener('mousedown', (e) => {\n    isResizing = true;\n    resizeStartX = e.clientX;\n    resizeStartY = e.clientY;\n    startWidth = container.offsetWidth;\n    startHeight = container.offsetHeight;\n\n    // Add overlay during resize\n    const overlay = document.createElement('div');\n    overlay.id = 'email-to-ics-resize-overlay';\n    overlay.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      z-index: 2147483646;\n      cursor: nwse-resize;\n    `;\n    document.body.appendChild(overlay);\n\n    e.preventDefault();\n    e.stopPropagation();\n  });\n\n  document.addEventListener('mousemove', (e) => {\n    if (!isResizing) return;\n\n    const deltaX = e.clientX - resizeStartX;\n    const deltaY = e.clientY - resizeStartY;\n\n    const newWidth = Math.max(350, startWidth + deltaX);\n    const newHeight = Math.max(400, startHeight + deltaY);\n\n    container.style.width = newWidth + 'px';\n    container.style.height = newHeight + 'px';\n  });\n\n  document.addEventListener('mouseup', () => {\n    if (isResizing) {\n      isResizing = false;\n\n      // Remove overlay\n      const overlay = document.getElementById('email-to-ics-resize-overlay');\n      if (overlay) {\n        overlay.remove();\n      }\n    }\n  });\n\n  container.appendChild(resizeHandle);\n}\n\nfunction removeIframe() {\n  const container = document.getElementById('email-to-ics-container');\n  if (container) {\n    container.remove();\n  }\n\n  if (emailToIcsFrame) {\n    emailToIcsFrame = null;\n  }\n\n  if (dragHandle) {\n    dragHandle = null;\n  }\n\n  // Clean up any overlays that might be left\n  const dragOverlay = document.getElementById('email-to-ics-drag-overlay');\n  if (dragOverlay) {\n    dragOverlay.remove();\n  }\n\n  const resizeOverlay = document.getElementById('email-to-ics-resize-overlay');\n  if (resizeOverlay) {\n    resizeOverlay.remove();\n  }\n}\n\n// Listen for messages from iframe to parent\nwindow.addEventListener('message', (event) => {\n  if (event.source === emailToIcsFrame?.contentWindow) {\n    if (event.data.type === 'RESIZE_IFRAME') {\n      const container = document.getElementById('email-to-ics-container');\n      if (container) {\n        // Adjust container height, accounting for the drag handle (30px)\n        container.style.height = (event.data.height + 30) + 'px';\n      }\n    } else if (event.data.type === 'CLOSE_IFRAME') {\n      removeIframe();\n    }\n  }\n});\n\n// Keyboard shortcut to toggle iframe\ndocument.addEventListener('keydown', (e) => {\n  if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'E') {\n    e.preventDefault();\n    if (emailToIcsFrame) {\n      removeIframe();\n    } else {\n      createIframe();\n    }\n  }\n});"],
  "mappings": "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",
  "names": ["container"]
}
